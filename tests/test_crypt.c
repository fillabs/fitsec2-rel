/*********************************************************************
This file is a part of FItsSec project: Implementation of ETSI TS 103 097
Copyright (C) 2015  Denis Filatov (danya.filatov()gmail.com)

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 3 of the License, or
(at your option) any later version.

This program is distributed under GNU GPLv3 in the hope that it will
be useful, but WITHOUT ANY WARRANTY; without even the implied warranty
of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Foobar.  If not, see <http://www.gnu.org/licenses/gpl-3.0.txt>.
@license GPL-3.0+ <http://www.gnu.org/licenses/gpl-3.0.txt>

In particular cases this program can be distributed under other license
by simple request to the author. 
*********************************************************************/
#define _CRT_SECURE_NO_WARNINGS

#include "fitsec.h"
#include "cmem.h"

#include <stdio.h>
#include <stdlib.h>
#include <ctype.h>
#include <inttypes.h>

static const uint8_t _sample[] = { 's', 'a', 'm', 'p', 'l', 'e' };

static const uint8_t sha256_sample[32] = {
    0xaf, 0x2b, 0xdb, 0xe1, 0xaa, 0x9b, 0x6e, 0xc1, 0xe2, 0xad, 0xe1, 0xd6, 0x94, 0xf4, 0x1f, 0xc7,
    0x1a, 0x83, 0x1d, 0x02, 0x68, 0xe9, 0x89, 0x15, 0x62, 0x11, 0x3d, 0x8a, 0x62, 0xad, 0xd1, 0xbf
};

static const uint8_t prk_nist256[32] = {
    0xC9, 0xAF, 0xA9, 0xD8, 0x45, 0xBA, 0x75, 0x16, 0x6B, 0x5C, 0x21, 0x57, 0x67, 0xB1, 0xD6, 0x93,
    0x4E, 0x50, 0xC3, 0xDB, 0x36, 0xE8, 0x9B, 0x12, 0x7B, 0x8A, 0x62, 0x2B, 0x12, 0x0F, 0x67, 0x21
};
static const uint8_t puk_x_nist256[32] = {
    0x60, 0xFE, 0xD4, 0xBA, 0x25, 0x5A, 0x9D, 0x31, 0xC9, 0x61, 0xEB, 0x74, 0xC6, 0x35, 0x6D, 0x68,
    0xC0, 0x49, 0xB8, 0x92, 0x3B, 0x61, 0xFA, 0x6C, 0xE6, 0x69, 0x62, 0x2E, 0x60, 0xF2, 0x9F, 0xB6
};
static const uint8_t puk_y_nist256[32] = {
    0x79, 0x03, 0xFE, 0x10, 0x08, 0xB8, 0xBC, 0x99, 0xA4, 0x1A, 0xE9, 0xE9, 0x56, 0x28, 0xBC, 0x64,
    0xF2, 0xF1, 0xB2, 0x0C, 0x2D, 0x7E, 0x9F, 0x51, 0x77, 0xA3, 0xC2, 0x94, 0xD4, 0x46, 0x22, 0x99
};
static const uint8_t sign_k_nist256[32] = {
    0xA6, 0xE3, 0xC5, 0x7D, 0xD0, 0x1A, 0xBE, 0x90, 0x08, 0x65, 0x38, 0x39, 0x83, 0x55, 0xDD, 0x4C,
    0x3B, 0x17, 0xAA, 0x87, 0x33, 0x82, 0xB0, 0xF2, 0x4D, 0x61, 0x29, 0x49, 0x3D, 0x8A, 0xAD, 0x60
};
static const uint8_t sign_r_nist256[32] = {
    0xEF, 0xD4, 0x8B, 0x2A, 0xAC, 0xB6, 0xA8, 0xFD, 0x11, 0x40, 0xDD, 0x9C, 0xD4, 0x5E, 0x81, 0xD6,
    0x9D, 0x2C, 0x87, 0x7B, 0x56, 0xAA, 0xF9, 0x91, 0xC3, 0x4D, 0x0E, 0xA8, 0x4E, 0xAF, 0x37, 0x16
};
static const uint8_t sign_s_nist256[32] = {
    0xF7, 0xCB, 0x1C, 0x94, 0x2D, 0x65, 0x7C, 0x41, 0xD4, 0x36, 0xC7, 0xA1, 0xB6, 0xE2, 0x9F, 0x65,
    0xF3, 0xE9, 0x00, 0xDB, 0xB9, 0xAF, 0xF4, 0x06, 0x4D, 0xC4, 0xAB, 0x2F, 0x84, 0x3A, 0xCD, 0xA8
};

static const uint8_t sign_nist256_msg_2 [] = {
    0x44, 0xac, 0xf6, 0xb7, 0xe3, 0x6c, 0x13, 0x42, 0xc2, 0xc5, 0x89, 0x72, 0x04, 0xfe, 0x09, 0x50,
    0x4e, 0x1e, 0x2e, 0xfb, 0x1a, 0x90, 0x03, 0x77, 0xdb, 0xc4, 0xe7, 0xa6, 0xa1, 0x33, 0xec, 0x56
};
static const uint8_t sign_nist256_d_2 [] = {
    0x51, 0x9b, 0x42, 0x3d, 0x71, 0x5f, 0x8b, 0x58, 0x1f, 0x4f, 0xa8, 0xee, 0x59, 0xf4, 0x77, 0x1a,
    0x5b, 0x44, 0xc8, 0x13, 0x0b, 0x4e, 0x3e, 0xac, 0xca, 0x54, 0xa5, 0x6d, 0xda, 0x72, 0xb4, 0x64
};
static const uint8_t sign_nist256_Qx_2 [] = {
    0x1c, 0xcb, 0xe9, 0x1c, 0x07, 0x5f, 0xc7, 0xf4, 0xf0, 0x33, 0xbf, 0xa2, 0x48, 0xdb, 0x8f, 0xcc,
    0xd3, 0x56, 0x5d, 0xe9, 0x4b, 0xbf, 0xb1, 0x2f, 0x3c, 0x59, 0xff, 0x46, 0xc2, 0x71, 0xbf, 0x83
};
static const uint8_t sign_nist256_Qy_2 [] = {
    0xce, 0x40, 0x14, 0xc6, 0x88, 0x11, 0xf9, 0xa2, 0x1a, 0x1f, 0xdb, 0x2c, 0x0e, 0x61, 0x13, 0xe0,
    0x6d, 0xb7, 0xca, 0x93, 0xb7, 0x40, 0x4e, 0x78, 0xdc, 0x7c, 0xcd, 0x5c, 0xa8, 0x9a, 0x4c, 0xa9
};
static const uint8_t sign_nist256_k_2 [] = {
    0x94, 0xa1, 0xbb, 0xb1, 0x4b, 0x90, 0x6a, 0x61, 0xa2, 0x80, 0xf2, 0x45, 0xf9, 0xe9, 0x3c, 0x7f,
    0x3b, 0x4a, 0x62, 0x47, 0x82, 0x4f, 0x5d, 0x33, 0xb9, 0x67, 0x07, 0x87, 0x64, 0x2a, 0x68, 0xde
};
static const uint8_t sign_nist256_r_2 [] = {
    0xf3, 0xac, 0x80, 0x61, 0xb5, 0x14, 0x79, 0x5b, 0x88, 0x43, 0xe3, 0xd6, 0x62, 0x95, 0x27, 0xed,
    0x2a, 0xfd, 0x6b, 0x1f, 0x6a, 0x55, 0x5a, 0x7a, 0xca, 0xbb, 0x5e, 0x6f, 0x79, 0xc8, 0xc2, 0xac
};
static const uint8_t sign_nist256_s_2 [] = {
    0x8b, 0xf7, 0x78, 0x19, 0xca, 0x05, 0xa6, 0xb2, 0x78, 0x6c, 0x76, 0x26, 0x2b, 0xf7, 0x37, 0x1c,
    0xef, 0x97, 0xb2, 0x18, 0xe9, 0x6f, 0x17, 0x5a, 0x3c, 0xcd, 0xda, 0x2a, 0xcc, 0x05, 0x89, 0x03
};

static const uint8_t sign_nist256_msg_3 [] = {
    0xDE, 0x4A, 0xA4, 0x50, 0xED, 0x16, 0x82, 0xF0, 0x01, 0xAB, 0x28, 0xD8, 0x0B, 0xC3, 0xD4, 0xE5,
    0x55, 0x00, 0x2A, 0x7B, 0x6A, 0x52, 0x47, 0x66, 0x59, 0xE7, 0x01, 0xF1, 0x0A, 0x0D, 0x7F, 0xB1
};
static const uint8_t sign_nist256_r_3 [] = {
    0x21, 0x95, 0x3A, 0xF4, 0x8C, 0x22, 0xC5, 0x43, 0xD4, 0x90, 0xD3, 0x28, 0x56, 0xA8, 0x8B, 0xC8,
    0xFF, 0x9A, 0xE6, 0x72, 0x84, 0xF9, 0x89, 0x6D, 0x8D, 0x67, 0x17, 0x72, 0xE3, 0x24, 0xA4, 0xCB
};
static const uint8_t sign_nist256_s_3 [] = {
    0x95, 0x03, 0xB5, 0xE3, 0xB4, 0xD7, 0xBD, 0xB7, 0x8E, 0x08, 0xD2, 0xBB, 0xC5, 0xD1, 0x82, 0xFF,
    0x3C, 0x60, 0xC5, 0x85, 0xF4, 0x7A, 0x4C, 0x29, 0x41, 0x63, 0x6C, 0x7E, 0x99, 0xBC, 0x79, 0xBF
};
static const uint8_t sign_nist256_d_3 [] = {
    0x32, 0xB0, 0xBA, 0xC1, 0x9C, 0x38, 0xE9, 0x3A, 0x82, 0x14, 0x13, 0x28, 0x1C, 0x47, 0x55, 0xE6,
    0xDC, 0x25, 0xB6, 0xCE, 0x5A, 0x12, 0xDA, 0x8A, 0xAB, 0x49, 0xFC, 0x9B, 0xBC, 0x86, 0xED, 0xE2
};
static const uint8_t sign_nist256_Qx_3 [] = {
    0x4B, 0x1A, 0x9F, 0x15, 0x5C, 0xFD, 0x5B, 0x99, 0xBB, 0x25, 0xD9, 0xA1, 0x20, 0x7C, 0xB4, 0x8A,
    0x17, 0x28, 0x7E, 0x37, 0x90, 0xE3, 0x19, 0xD2, 0x38, 0x73, 0xAE, 0x54, 0xB9, 0x93, 0x19, 0x22
};

static struct {
    FSCurve         curve;
    const uint8_t * data;
    const size_t    data_size;
    const uint8_t * prk;
    const uint8_t * pub_x;
    const uint8_t * pub_y;
    const uint8_t * hash;
    const uint8_t * k;
    const uint8_t * r;
    const uint8_t * s;
} _sign_vectors[] = {
    {
        FS_NISTP256,
        _sample, sizeof(_sample),
        prk_nist256, puk_x_nist256, puk_y_nist256,
        sha256_sample,
        sign_k_nist256, sign_r_nist256, sign_s_nist256
    },
    {
        FS_NISTP256,
        NULL, 0,
        sign_nist256_d_2, sign_nist256_Qx_2, sign_nist256_Qy_2,
        sign_nist256_msg_2,
        sign_nist256_k_2, sign_nist256_r_2, sign_nist256_s_2
    },
    {
        FS_NISTP256,
        NULL, 0,
        sign_nist256_d_3, sign_nist256_Qx_3, NULL,
        sign_nist256_msg_3,
        NULL, sign_nist256_r_3, sign_nist256_s_3
    }
};

// static void hexdump(FILE* f, const uint8_t* b, size_t len);
static void* _xor_sym_key_aligned(void* const out, const void* const p1, const void* const p2, size_t len);

static const uint8_t symKey1[16] =
{ 0xE5, 0x8D, 0x5C, 0x8F, 0x8C, 0x9E, 0xD9, 0x78, 0x56, 0x79, 0xE0, 0x8A, 0xBC, 0x7C, 0x81, 0x16 };

static const uint8_t nonce1[12] =
{ 0xA9, 0xF5, 0x93, 0xC0, 0x9E, 0xAE, 0xEA, 0x8B, 0xF0, 0xC1, 0xCF, 0x6A };

static const uint8_t pt1[] =
{ 0x06, 0x53, 0xB5, 0x71, 0x4D, 0x13, 0x57, 0xF4, 0x99, 0x5B, 0xDD, 0xAC, 0xBE, 0x10, 0x87, 0x39,
  0x51, 0xA1, 0xEB, 0xA6, 0x63, 0x71, 0x8D, 0x1A, 0xF3, 0x5D, 0x2F, 0x0D, 0x52, 0xC7, 0x9D, 0xE4,
  0x9B, 0xE6, 0x22, 0xC4, 0xA6, 0xD9, 0x06, 0x47, 0xBA, 0x2B, 0x00, 0x4C, 0x3E, 0x8A, 0xE4, 0x22,
  0xFD, 0x27, 0x06, 0x3A, 0xFA, 0x19, 0xAD, 0x88, 0x3D, 0xCC, 0xBD, 0x97, 0xD9, 0x8B, 0x8B, 0x04,
  0x61, 0xB5, 0x67, 0x1E, 0x75, 0xF1, 0x97, 0x01, 0xC2, 0x40, 0x42, 0xB8, 0xD3, 0xAF, 0x79, 0xB9,
  0xFF, 0x62, 0xBC, 0x44, 0x8E, 0xF9, 0x44, 0x0B, 0x1E, 0xA3, 0xF7, 0xE5, 0xC0, 0xF4, 0xBF, 0xEF,
  0xE3, 0xE3, 0x26, 0xE6, 0x2D, 0x5E, 0xE4, 0xCB, 0x4B, 0x4C, 0xFF, 0xF3, 0x0A, 0xD5, 0xF4, 0x9A,
  0x79, 0x81, 0xAB, 0xF7, 0x16, 0x17, 0x24, 0x5B, 0x96, 0xE5, 0x22, 0xE1, 0xAD, 0xD7, 0x8A
};
static const uint8_t ct1[] =
{ 0x5F, 0x82, 0xB9, 0xFC, 0xE3, 0x4B, 0x94, 0x83, 0x53, 0x95, 0xDD, 0x89, 0xD7, 0x1F, 0xB7, 0x58,
  0xD2, 0xA3, 0x90, 0x7F, 0xBF, 0x2F, 0xD5, 0x89, 0x94, 0xA2, 0xB9, 0xCF, 0x87, 0x25, 0xAF, 0x26,
  0xF0, 0xB2, 0x38, 0x53, 0xC2, 0x7A, 0x06, 0xE3, 0x5E, 0xE7, 0x2C, 0xAD, 0x82, 0x77, 0x13, 0xC1,
  0x8F, 0xA5, 0xDD, 0xA9, 0x71, 0xD9, 0xBA, 0xA7, 0xB4, 0x2A, 0x30, 0x1F, 0xF6, 0x0C, 0x6E, 0x4A,
  0xD6, 0x51, 0xC1, 0xBB, 0x6E, 0xD4, 0xF2, 0x5F, 0x7D, 0x0F, 0xF3, 0x87, 0xA1, 0x16, 0x27, 0x93,
  0x4C, 0xD1, 0x1F, 0x86, 0x98, 0x4E, 0xA3, 0xAC, 0x96, 0x9D, 0xDA, 0x9A, 0x02, 0x0A, 0xD6, 0x42,
  0x4B, 0x0D, 0x39, 0x3E, 0x3F, 0xB4, 0xB1, 0x11, 0x9A, 0xDF, 0x5C, 0xDB, 0x01, 0x2A, 0x59, 0x75,
  0x3E, 0x41, 0xD4, 0x7E, 0x5E, 0x5A, 0x8C, 0x3A, 0x11, 0x8E, 0xD4, 0x07, 0x04, 0x9B, 0x56, 0xD5,
  0x3B, 0xF5, 0x6C, 0xB3, 0x8C, 0x0B, 0x20, 0xA2, 0x50, 0x2D, 0x1D, 0xA7, 0x0B, 0x97, 0x61
};

static const uint8_t pt2[] =
{ 0xAC, 0xA6, 0x50, 0xCC, 0xCC, 0xDA, 0x60, 0x4E, 0x16, 0xA8, 0xB5, 0x4A, 0x33, 0x35, 0xE0, 0xBC,
  0x2F, 0xD9, 0x44, 0x4F, 0x33, 0xE3, 0xD9, 0xB8, 0x2A, 0xFE, 0x6F, 0x44, 0x53, 0x57, 0x63, 0x49,
  0x74, 0xF0, 0xF1, 0x72, 0x8C, 0xF1, 0x13, 0x45, 0x23, 0x21, 0xCB, 0xE5, 0x85, 0x83, 0x04, 0xB0,
  0x1D, 0x4A, 0x14, 0xAE, 0x7F, 0x3B, 0x45, 0x98, 0x0E, 0xE8, 0x03, 0x3A, 0xD2, 0xA8, 0x59, 0x9B,
  0x78, 0xC2, 0x94, 0x94, 0xC9, 0xE5, 0xF8, 0x94, 0x5A, 0x8C, 0xAD, 0xE3, 0xEB, 0x5A, 0x30, 0xD1,
  0x56, 0xC0, 0xD8, 0x32, 0x71, 0x62, 0x6D, 0xAD, 0xDB, 0x65, 0x09, 0x54, 0x09, 0x34, 0x43, 0xFB,
  0xAC, 0x97, 0x01, 0xC0, 0x2E, 0x5A, 0x97, 0x3F, 0x39, 0xC2, 0xE1, 0x76, 0x1A, 0x4B, 0x48, 0xC7,
  0x64, 0xBF, 0x6D, 0xB2, 0x15, 0xA5, 0x4B, 0x28, 0x5A, 0x06, 0xEC, 0xA3, 0xAF, 0x0A, 0x83, 0xF7 };

static const uint8_t ct2[] =
{ 0xF5, 0x77, 0x5C, 0x41, 0x62, 0x82, 0xA3, 0x39, 0xDC, 0x66, 0xB5, 0x6F, 0x5A, 0x3A, 0xD0, 0xDD,
  0xAC, 0xDB, 0x3F, 0x96, 0xEF, 0xBD, 0x81, 0x2B, 0x4D, 0x01, 0xF9, 0x86, 0x86, 0xB5, 0x51, 0x8B,
  0x1F, 0xA4, 0xEB, 0xE5, 0xE8, 0x52, 0x13, 0xE1, 0xC7, 0xED, 0xE7, 0x04, 0x39, 0x7E, 0xF3, 0x53,
  0x6F, 0xC8, 0xCF, 0x3D, 0xF4, 0xFB, 0x52, 0xB7, 0x87, 0x0E, 0x8E, 0xB2, 0xFD, 0x2F, 0xBC, 0xD5,
  0xCF, 0x26, 0x32, 0x31, 0xD2, 0xC0, 0x9D, 0xCA, 0xE5, 0xC3, 0x1C, 0xDC, 0x99, 0xE3, 0x6E, 0xFB,
  0xE5, 0x73, 0x7B, 0xF0, 0x67, 0xD5, 0x8A, 0x0A, 0x53, 0x5B, 0x24, 0x2B, 0xCB, 0xCA, 0x2A, 0x56,
  0x04, 0x79, 0x1E, 0x18, 0x3C, 0xB0, 0xC2, 0xE5, 0xE8, 0x51, 0x42, 0x5E, 0x11, 0xB4, 0xE5, 0x28,
  0x23, 0x7F, 0x12, 0x3B, 0x5D, 0xE8, 0xE3, 0x49, 0xDD, 0x6D, 0x1A, 0x45, 0x06, 0x46, 0x5F, 0x72,
  0x57, 0x00, 0x10, 0x80, 0x00, 0x38, 0x72, 0x27, 0x19, 0x00, 0xD3, 0xF3, 0x9C, 0x96, 0x61, 0xFD };

static const uint8_t pt3[] =
{ 0xD1, 0xAA, 0x8B, 0xBC, 0x04, 0xDF, 0xC9, 0x2F, 0xFE, 0x2C, 0xB7, 0x74, 0x8E, 0x70, 0xB0, 0x2F,
  0x5A, 0x91, 0xDA, 0x14, 0x78, 0x12, 0x23, 0xA7, 0x12, 0xD4, 0x4C, 0x4B, 0xA1, 0x4A, 0x1C, 0x78,
  0xEB, 0x02, 0x38, 0x7F, 0xE7, 0x3F, 0xDC, 0xBC, 0xA8, 0x44, 0x70, 0x56, 0xAC, 0xAA, 0x9B, 0x5F,
  0x94, 0xD5, 0x20, 0x89, 0x72, 0xB7, 0x06, 0xDF, 0x9F, 0xC4, 0xC8, 0x03, 0xEA, 0xBB, 0x2B, 0xC5,
  0x8C, 0x3D, 0x8D, 0xF4, 0xAC, 0x49, 0x6C, 0x34, 0xCB, 0x6B, 0xAB, 0x93, 0x94, 0x78, 0xCB, 0x41,
  0x79, 0x95, 0xB2, 0x31, 0x4D, 0xAF, 0x7A, 0xF3, 0xF4, 0xC8, 0xA8, 0xD5, 0xD5, 0x7A, 0x03, 0xF0,
  0xEB, 0x2B, 0x7B, 0xBD, 0x2D, 0x16, 0xBA, 0xBB, 0xF2, 0x2C, 0x5B, 0x1E, 0xEB, 0xFF, 0x72, 0xC7,
  0xDD, 0x4F, 0x91, 0x2D, 0x58, 0x21, 0xF9, 0xA6, 0xBF, 0xA2, 0xD0, 0x63, 0xCE, 0x6F, 0x66, 0x48,
  0xDF };
static const uint8_t ct3[] =
{ 0x88, 0x7B, 0x87, 0x31, 0xAA, 0x87, 0x0A, 0x58, 0x34, 0xE2, 0xB7, 0x51, 0xE7, 0x7F, 0x80, 0x4E,
  0xD9, 0x93, 0xA1, 0xCD, 0xA4, 0x4C, 0x7B, 0x34, 0x75, 0x2B, 0xDA, 0x89, 0x74, 0xA8, 0x2E, 0xBA,
  0x80, 0x56, 0x22, 0xE8, 0x83, 0x9C, 0xDC, 0x18, 0x4C, 0x88, 0x5C, 0xB7, 0x10, 0x57, 0x6C, 0xBC,
  0xE6, 0x57, 0xFB, 0x1A, 0xF9, 0x77, 0x11, 0xF0, 0x16, 0x22, 0x45, 0x8B, 0xC5, 0x3C, 0xCE, 0x8B,
  0x3B, 0xD9, 0x2B, 0x51, 0xB7, 0x6C, 0x09, 0x6A, 0x74, 0x24, 0x1A, 0xAC, 0xE6, 0xC1, 0x95, 0x6B,
  0xCA, 0x26, 0x11, 0xF3, 0x5B, 0x18, 0x9D, 0x54, 0x7C, 0xF6, 0x85, 0xAA, 0x17, 0x84, 0x6A, 0x5D,
  0x43, 0xC5, 0x64, 0x65, 0x3F, 0xFC, 0xEF, 0x61, 0x23, 0xBF, 0xF8, 0x36, 0xE0, 0x00, 0xDF, 0x28,
  0x9A, 0x8F, 0xEE, 0xA4, 0x10, 0x6C, 0x51, 0xC7, 0x38, 0xC9, 0x26, 0x85, 0x67, 0x23, 0xBA, 0xCD,
  0xB3, 0xF5, 0xD0, 0xF8, 0x7F, 0x7E, 0x29, 0xD9, 0x4B, 0xF1, 0xB4, 0x1D, 0xE8, 0x06, 0x3E, 0x10,
  0x71 };

static const uint8_t pt4[] =
{ 0xF7, 0x62, 0x9B, 0x73, 0xDA, 0xE8, 0x5A, 0x9B, 0xCA, 0x45, 0xC4, 0x2E, 0xB7, 0xFC, 0x18, 0x18,
  0xDC, 0x74, 0xA6, 0x0E, 0x13, 0xAE, 0x65, 0xA0, 0x43, 0xE2, 0x4B, 0x5A, 0x4D, 0x3A, 0xE0, 0x4C,
  0x27, 0x3E, 0x7D, 0x6F, 0x42, 0x71, 0x0F, 0x2D, 0x22, 0x3D, 0x09, 0xEB, 0x7C, 0x13, 0x15, 0x71,
  0x8A, 0x5A, 0x12, 0x93, 0xD4, 0x82, 0xE4, 0xC4, 0x5C, 0x3E, 0x85, 0x2E, 0x51, 0x06, 0xAA, 0xD7,
  0xB6, 0x95, 0xA0, 0x2C, 0x48, 0x54, 0x80, 0x1A, 0x5E, 0xFE, 0x93, 0x7A, 0x65, 0x40, 0xBC, 0xE8,
  0x73, 0x4E, 0x81, 0x41, 0x55, 0x8C, 0x34, 0x33, 0xB1, 0xD4, 0xC7, 0x33, 0xDC, 0x5E, 0xF9, 0xC4,
  0x7B, 0x52, 0x79, 0xAA, 0x46, 0xEE, 0x3D, 0x8B, 0xD3, 0x3B, 0x09, 0x50, 0xBE, 0x5C, 0x9E, 0xBD,
  0xF1, 0x8B, 0xCF, 0x06, 0x9B, 0x6D, 0xAF, 0x82, 0xFF, 0x11, 0x86, 0x91, 0x2F, 0x0A, 0xBA };

static const uint8_t ct4[] =
{ 0xDE, 0xDE, 0x57, 0x5B, 0x6E, 0xFE, 0x39, 0x0F, 0x2C, 0xBB, 0x4F, 0x36, 0x8A, 0x71, 0x1F, 0x6C,
  0xDF, 0x69, 0xAB, 0xD1, 0x1A, 0xF5, 0x80, 0xB2, 0xBF, 0x40, 0x29, 0xF8, 0x5E, 0xB8, 0x35, 0xD1,
  0xAB, 0xDD, 0xB3, 0x0E, 0x9E, 0x9C, 0xF3, 0xF1, 0x3C, 0xBA, 0x3B, 0xCC, 0x2E, 0x91, 0x87, 0x13,
  0xD2, 0x18, 0xAF, 0x0D, 0x07, 0xCC, 0x61, 0x4A, 0xF6, 0x98, 0x92, 0xAF, 0xA9, 0x86, 0xAF, 0x2D,
  0x5E, 0x60, 0xED, 0xB0, 0x5D, 0x09, 0xD3, 0xB2, 0x9E, 0x2A, 0x65, 0xB5, 0x43, 0xAD, 0x6F, 0x26,
  0xE5, 0xD7, 0x6B, 0x66, 0x0F, 0xE9, 0x18, 0x49, 0x06, 0xA6, 0x31, 0x5C, 0xD6, 0xB5, 0x35, 0x5F,
  0xA2, 0x91, 0xA1, 0xE9, 0x0C, 0x51, 0x0D, 0xF2, 0x0E, 0x46, 0xC1, 0x16, 0xE2, 0x18, 0x00, 0x09,
  0xC2, 0x87, 0x65, 0x9D, 0xB8, 0xD4, 0x5C, 0xC3, 0x96, 0x80, 0x49, 0xFA, 0x29, 0xF0, 0x8D, 0xE5,
  0xD1, 0x56, 0xED, 0xF7, 0xB0, 0xDB, 0xC8, 0x4E, 0x41, 0x0F, 0x29, 0x28, 0x68, 0xC4, 0xBE };

static const uint8_t symKey4[] =
{ 0xB8, 0x45, 0x3A, 0x72, 0x80, 0x60, 0xF8, 0xD5, 0x17, 0xBA, 0xCE, 0xED, 0x38, 0x29, 0xF4, 0xD9 };
static const uint8_t nonce4[] = 
{ 0xCF, 0xBC, 0xE6, 0x9C, 0x88, 0x4D, 0x5B, 0xAB, 0xBB, 0xAA, 0xF9, 0xA3 };

static const uint8_t pt5[] =
{ 0x29, 0xB4, 0x01, 0x3F, 0x55, 0x2F, 0xBC, 0xE9, 0x93, 0x54, 0x4C, 0xC6, 0x60, 0x5C, 0xB0, 0x5C,
  0x62, 0xA7, 0x89, 0x4C, 0x4C, 0x99, 0xE6, 0xA1, 0x2C, 0x5F, 0x9F, 0x2E, 0xE4, 0xDF, 0xBE, 0xBA,
  0xD7, 0x0C, 0xDD, 0x08, 0x93, 0x54, 0x22, 0x40, 0xF2, 0x8B, 0xB5, 0xFB, 0xB9, 0x09, 0x03, 0x32,
  0xED, 0x11, 0x0A, 0xBF, 0xAE, 0x6C, 0x4C, 0x64, 0x60, 0xD9, 0x16, 0xF8, 0x99, 0x41, 0x36, 0x57,
  0x5B, 0x5A, 0x6F, 0xD8, 0xDB, 0x60, 0x5F, 0xDF, 0x14, 0xCB, 0x81, 0x97, 0x7A, 0xFF, 0x7F, 0x99,
  0xB5, 0x27, 0x25, 0x80, 0xBF, 0x22, 0x01, 0x33, 0xC6, 0x91, 0xB0, 0x9B, 0xAD, 0xC4, 0xD1, 0xFE,
  0x71, 0x25, 0xFD, 0x17, 0xFD, 0xBF, 0xC1, 0x03, 0xE3, 0xF0, 0x0A, 0x4D, 0x8E, 0x5A, 0x6F, 0x1E,
  0x3D, 0x3A, 0xF2, 0xA9, 0x08, 0x53, 0x5D, 0xE8, 0x58, 0xE1, 0xCC, 0xD3, 0xDB, 0x4D, 0x18, 0x35 };

static const uint8_t ct5[] =
{ 0x00, 0x08, 0xCD, 0x17, 0xE1, 0x39, 0xDF, 0x7D, 0x75, 0xAA, 0xC7, 0xDE, 0x5D, 0xD1, 0xB7, 0x28,
  0x61, 0xBA, 0x84, 0x93, 0x45, 0xC2, 0x03, 0xB3, 0xD0, 0xFD, 0xFD, 0x8C, 0xF7, 0x5D, 0x6B, 0x27,
  0x5B, 0xEF, 0x13, 0x69, 0x4F, 0xB9, 0xDE, 0x9C, 0xEC, 0x0C, 0x87, 0xDC, 0xEB, 0x8B, 0x91, 0x50,
  0xB5, 0x53, 0xB7, 0x21, 0x7D, 0x22, 0xC9, 0xEA, 0xCA, 0x7F, 0x01, 0x79, 0x61, 0xC1, 0x33, 0xAD,
  0xB3, 0xAF, 0x22, 0x44, 0xCE, 0x3D, 0x0C, 0x77, 0xD4, 0x1F, 0x77, 0x58, 0x5C, 0x12, 0xAC, 0x57,
  0x23, 0xBE, 0xCF, 0xA7, 0xE5, 0x47, 0x2D, 0x49, 0x71, 0xE3, 0x46, 0xF4, 0xA7, 0x2F, 0x1D, 0x65,
  0xA8, 0xE6, 0x25, 0x54, 0xB7, 0x00, 0xF1, 0x7A, 0x3E, 0x8D, 0xC2, 0x0B, 0xD2, 0x1E, 0xF1, 0xAA,
  0x0E, 0x36, 0x58, 0x32, 0x2B, 0xEA, 0xAE, 0xA9, 0x31, 0x70, 0x03, 0xB8, 0xDD, 0xB7, 0x2F, 0xFD,
  0xFA, 0x08, 0x34, 0x97, 0x41, 0x52, 0xB9, 0x5B, 0xAD, 0xE2, 0xDF, 0x83, 0xD7, 0xEE, 0xC4, 0x55 };

static const uint8_t pt6[] =
{ 0x1D, 0x76, 0xBD, 0xF0, 0x62, 0x6A, 0x71, 0x34, 0xBE, 0xB2, 0x8A, 0x90, 0xD5, 0x4E, 0xD7, 0x79,
  0x6C, 0x4C, 0x95, 0x35, 0x46, 0x5C, 0x09, 0x0C, 0x4B, 0x58, 0x3A, 0x8C, 0xD4, 0x0E, 0xF0, 0xA3,
  0x86, 0x4E, 0x7C, 0x07, 0xCC, 0xAE, 0xD1, 0x40, 0xDF, 0x6B, 0x9D, 0x73, 0x23, 0x4E, 0x65, 0x2F,
  0x8F, 0xF4, 0x25, 0xFC, 0x20, 0x6F, 0x63, 0xDF, 0xAB, 0x7D, 0xCD, 0xBB, 0xBE, 0x30, 0x41, 0x1A,
  0x14, 0x69, 0x5E, 0x72, 0xA2, 0xBD, 0x8C, 0x4B, 0xFB, 0x1D, 0x69, 0x91, 0xDB, 0x4F, 0x99, 0xEE,
  0xA7, 0x43, 0x5E, 0x55, 0x26, 0x1E, 0x37, 0xFD, 0xF5, 0x7C, 0xE7, 0x9D, 0xF7, 0x25, 0xC8, 0x10,
  0x19, 0x2F, 0x5E, 0x6E, 0x03, 0x31, 0xED, 0x62, 0xEB, 0x8A, 0x72, 0xC5, 0xB9, 0xDA, 0x6D, 0xFD,
  0x97, 0x48, 0xB3, 0xD1, 0x68, 0xA6, 0x9B, 0xAB, 0x33, 0x31, 0x9E, 0xFD, 0x1E, 0x84, 0xEF, 0x25,
  0x70 };

static const uint8_t ct6[] =
{ 0x34, 0xCA, 0x71, 0xD8, 0xD6, 0x7C, 0x12, 0xA0, 0x58, 0x4C, 0x01, 0x88, 0xE8, 0xC3, 0xD0, 0x0D,
  0x6F, 0x51, 0x98, 0xEA, 0x4F, 0x07, 0xEC, 0x1E, 0xB7, 0xFA, 0x58, 0x2E, 0xC7, 0x8C, 0x25, 0x3E,
  0x0A, 0xAD, 0xB2, 0x66, 0x10, 0x43, 0x2D, 0x9C, 0xC1, 0xEC, 0xAF, 0x54, 0x71, 0xCC, 0xF7, 0x4D,
  0xD7, 0xB6, 0x98, 0x62, 0xF3, 0x21, 0xE6, 0x51, 0x01, 0xDB, 0xDA, 0x3A, 0x46, 0xB0, 0x44, 0xE0,
  0xFC, 0x9C, 0x13, 0xEE, 0xB7, 0xE0, 0xDF, 0xE3, 0x3B, 0xC9, 0x9F, 0x5E, 0xFD, 0xA2, 0x4A, 0x20,
  0x31, 0xDA, 0xB4, 0x72, 0x7C, 0x7B, 0x1B, 0x87, 0x42, 0x0E, 0x11, 0xF2, 0xFD, 0xCE, 0x04, 0x8B,
  0xC0, 0xEC, 0x86, 0x2D, 0x49, 0x8E, 0xDD, 0x1B, 0x36, 0xF7, 0xBA, 0x83, 0xE5, 0x9E, 0xF3, 0x49,
  0xA4, 0x44, 0x19, 0x4A, 0x4B, 0x1F, 0x68, 0xEA, 0x5A, 0xA0, 0x51, 0x96, 0x18, 0x7E, 0xD8, 0xED,
  0x68, 0x48, 0x26, 0xC0, 0xC3, 0x56, 0xA9, 0xB8, 0xED, 0xA5, 0x5B, 0xD9, 0x1C, 0x2B, 0xA1, 0x02,
  0x2B };


typedef struct {
    const uint8_t* key;
    const uint8_t* nonce;
    size_t pt_len;
    const uint8_t* pt;
    size_t ct_len;
    const uint8_t* ct;
}SymmEncVector;

static SymmEncVector _SymmEncVectors[] = {
    {
        &symKey1[0], &nonce1[0],
        sizeof(pt1),&pt1[0],
        sizeof(ct1),&ct1[0]
    }, {
        &symKey1[0],& nonce1[0],
        sizeof(pt2),&pt2[0],
        sizeof(ct2),&ct2[0]
    }, {
        &symKey1[0],& nonce1[0],
        sizeof(pt3),& pt3[0],
        sizeof(ct3),& ct3[0]
    }, {
        &symKey4[0],&nonce4[0],
        sizeof(pt4),&pt4[0],
        sizeof(ct4),&ct4[0]
    }, {
        &symKey4[0],&nonce4[0],
        sizeof(pt5),&pt5[0],
        sizeof(ct5),&ct5[0]
    }, {
        &symKey4[0],&nonce4[0],
        sizeof(pt6),&pt6[0],
        sizeof(ct6),&ct6[0]
    }
};

static const uint8_t v1[32] =
{ 0x13, 0x84, 0xC3, 0x1D, 0x69, 0x82, 0xD5, 0x2B, 0xCA, 0x3B, 0xED, 0x8A, 0x7E, 0x60, 0xF5, 0x2F,
  0xEC, 0xDA, 0xB4, 0x4E, 0x5C, 0x0E, 0xA1, 0x66, 0x81, 0x5A, 0x81, 0x59, 0xE0, 0x9F, 0xFB, 0x42 };
static const uint8_t V1x[32] =
{ 0xF4, 0x5A, 0x99, 0x13, 0x7B, 0x1B, 0xB2, 0xC1, 0x50, 0xD6, 0xD8, 0xCF, 0x72, 0x92, 0xCA, 0x07,
  0xDA, 0x68, 0xC0, 0x03, 0xDA, 0xA7, 0x66, 0xA9, 0xAF, 0x7F, 0x67, 0xF5, 0xEE, 0x91, 0x68, 0x28 };
static const uint8_t V1y[32] =
{ 0xF6, 0xA2, 0x52, 0x16, 0xF4, 0x4C, 0xB6, 0x4A, 0x96, 0xC2, 0x29, 0xAE, 0x00, 0xB4, 0x79, 0x85,
  0x7B, 0x3B, 0x81, 0xC1, 0x31, 0x9F, 0xB2, 0xAD, 0xF0, 0xE8, 0xDB, 0x26, 0x81, 0x76, 0x97, 0x29 };

static const uint8_t v2[32] =
{ 0xD4, 0x18, 0x76, 0x0F, 0x0C, 0xB2, 0xDC, 0xB8, 0x56, 0xBC, 0x3C, 0x72, 0x17, 0xAD, 0x3A, 0xA3,
  0x6D, 0xB6, 0x74, 0x2A, 0xE1, 0xDB, 0x65, 0x5A, 0x3D, 0x28, 0xDF, 0x88, 0xCB, 0xBF, 0x84, 0xE1 };
static const uint8_t V2x[32] =
{ 0xEE, 0x9C, 0xC7, 0xFB, 0xD9, 0xED, 0xEC, 0xEA, 0x41, 0xF7, 0xC8, 0xBD, 0x25, 0x8E, 0x8D, 0x2E,
  0x98, 0x8E, 0x75, 0xBD, 0x06, 0x9A, 0xDD, 0xCA, 0x1E, 0x5A, 0x38, 0xE5, 0x34, 0xAC, 0x68, 0x18 };
static const uint8_t V2y[32] =
{ 0x5A, 0xE3, 0xC8, 0xD9, 0xFE, 0x0B, 0x1F, 0xC7, 0x43, 0x8F, 0x29, 0x41, 0x7C, 0x24, 0x0F, 0x8B,
  0xF8, 0x1C, 0x35, 0x8E, 0xC1, 0xA4, 0xD0, 0xC6, 0xE9, 0x8D, 0x8E, 0xDB, 0xCC, 0x71, 0x40, 0x17 };

static const uint8_t v4[32] =
{ 0x46, 0x24, 0xA6, 0xF9, 0xF6, 0xBC, 0x6B, 0xD0, 0x88, 0xA7, 0x1E, 0xD9, 0x7B, 0x3A, 0xEE, 0x98,
  0x3B, 0x5C, 0xC2, 0xF5, 0x74, 0xF6, 0x4E, 0x96, 0xA5, 0x31, 0xD2, 0x46, 0x41, 0x37, 0x04, 0x9F };
static const uint8_t V4x[32] =
{ 0x12, 0x1A, 0xA4, 0x95, 0xC6, 0xB2, 0xC0, 0x7A, 0x2B, 0x2D, 0xAE, 0xC3, 0x6B, 0xD2, 0x07, 0xD6,
  0x62, 0x0D, 0x7E, 0x60, 0x81, 0x05, 0x0D, 0xF5, 0xDE, 0x3E, 0x96, 0x96, 0x86, 0x8F, 0xCD, 0xCA };
static const uint8_t V4y[32] =
{ 0x46, 0xC3, 0x1A, 0x1A, 0xBE, 0xA0, 0xBD, 0xDA, 0xAA, 0xAE, 0xFB, 0xBA, 0x3A, 0xFD, 0xBF, 0xF1,
  0xAC, 0x8D, 0x19, 0x6B, 0xC3, 0x13, 0xFC, 0x13, 0x09, 0x26, 0x81, 0x0C, 0x05, 0x50, 0x39, 0x50 };

static const uint8_t k1[16] =
{ 0x91, 0x69, 0x15, 0x5B, 0x08, 0xB0, 0x76, 0x74, 0xCB, 0xAD, 0xF7, 0x5F, 0xB4, 0x6A, 0x7B, 0x0D };
static const uint8_t k3[16] =
{ 0x68, 0x7E, 0x97, 0x57, 0xDE, 0xBF, 0xD8, 0x7B, 0x0C, 0x26, 0x73, 0x30, 0xC1, 0x83, 0xC7, 0xB6 };

static const uint8_t P1[32] =
{ 0xA6, 0xB7, 0xB5, 0x25, 0x54, 0xB4, 0x20, 0x3F, 0x7E, 0x3A, 0xCF, 0xDB, 0x3A, 0x3E, 0xD8, 0x67,
  0x4E, 0xE0, 0x86, 0xCE, 0x59, 0x06, 0xA7, 0xCA, 0xC2, 0xF8, 0xA3, 0x98, 0x30, 0x6D, 0x3B, 0xE9 };
static const uint8_t P3[32] =
{ 0x05, 0xBE, 0xD5, 0xF8, 0x67, 0xB8, 0x9F, 0x30, 0xFE, 0x55, 0x52, 0xDF, 0x41, 0x4B, 0x65, 0xB9,
  0xDD, 0x40, 0x73, 0xFC, 0x38, 0x5D, 0x14, 0x92, 0x1C, 0x64, 0x1A, 0x14, 0x5A, 0xA1, 0x20, 0x51 };

static const uint8_t r1[32] =
{ 0x06, 0x0E, 0x41, 0x44, 0x0A, 0x4E, 0x35, 0x15, 0x4C, 0xA0, 0xEF, 0xCB, 0x52, 0x41, 0x21, 0x45,
  0x83, 0x6A, 0xD0, 0x32, 0x83, 0x3E, 0x6B, 0xC7, 0x81, 0xE5, 0x33, 0xBF, 0x14, 0x85, 0x10, 0x85 };
static const uint8_t R1x[32] =
{ 0x8C, 0x5E, 0x20, 0xFE, 0x31, 0x93, 0x5F, 0x6F, 0xA6, 0x82, 0xA1, 0xF6, 0xD4, 0x6E, 0x44, 0x68,
  0x53, 0x4F, 0xFE, 0xA1, 0xA6, 0x98, 0xB1, 0x4B, 0x0B, 0x12, 0x51, 0x3E, 0xED, 0x8D, 0xEB, 0x11 };
static const uint8_t R1y[32] =
{ 0x12, 0x70, 0xFE, 0xC2, 0x42, 0x7E, 0x6A, 0x15, 0x4D, 0xFC, 0xAE, 0x33, 0x68, 0x58, 0x43, 0x96,
  0xC8, 0x25, 0x1A, 0x04, 0xE2, 0xAE, 0x7D, 0x87, 0xB0, 0x16, 0xFF, 0x65, 0xD2, 0x2D, 0x6F, 0x9E };

static const uint8_t r3[32] =
{ 0xDA, 0x5E, 0x1D, 0x85, 0x3F, 0xCC, 0x5D, 0x0C, 0x16, 0x2A, 0x24, 0x5B, 0x9F, 0x29, 0xD3, 0x8E,
  0xB6, 0x05, 0x9F, 0x0D, 0xB1, 0x72, 0xFB, 0x7F, 0xDA, 0x66, 0x63, 0xB9, 0x25, 0xE8, 0xC7, 0x44 };
static const uint8_t R3x[32] =
{ 0x80, 0x08, 0xB0, 0x6F, 0xC4, 0xC9, 0xF9, 0x85, 0x60, 0x48, 0xDA, 0x18, 0x6E, 0x7D, 0xC3, 0x90,
  0x96, 0x3D, 0x6A, 0x42, 0x4E, 0x80, 0xB2, 0x74, 0xFB, 0x75, 0xD1, 0x21, 0x88, 0xD7, 0xD7, 0x3F };
static const uint8_t R3y[32] =
{ 0x27, 0x74, 0xFB, 0x96, 0x00, 0xF2, 0x7D, 0x7B, 0x3B, 0xBB, 0x2F, 0x7F, 0xCD, 0x8D, 0x2C, 0x96,
  0xD4, 0x61, 0x9E, 0xF9, 0xB4, 0x69, 0x2C, 0x6A, 0x7C, 0x57, 0x33, 0xB5, 0xBA, 0xC8, 0xB2, 0x7D };

static const uint8_t C1[16] =
{ 0xA6, 0x34, 0x20, 0x13, 0xD6, 0x23, 0xAD, 0x6C, 0x5F, 0x68, 0x82, 0x46, 0x96, 0x73, 0xAE, 0x33 };
static const uint8_t C2[16] =
{ 0xDD, 0x53, 0x0B, 0xE3, 0xBC, 0xD1, 0x49, 0xE8, 0x81, 0xE0, 0x9F, 0x06, 0xE1, 0x60, 0xF5, 0xA0 };
static const uint8_t C3[16] =
{ 0x1F, 0x63, 0x46, 0xED, 0xAE, 0xAF, 0x57, 0x56, 0x1F, 0xC9, 0x60, 0x4F, 0xEB, 0xEF, 0xF4, 0x4E };
static const uint8_t C4[16] =
{ 0x6C, 0xFD, 0x13, 0xB7, 0x64, 0x36, 0xCD, 0x0D, 0xB7, 0x02, 0x44, 0xFA, 0xE3, 0x80, 0xCB, 0xA1 };

static const uint8_t T1[16] =
{ 0x80, 0xE1, 0xD8, 0x5D, 0x30, 0xF1, 0xBA, 0xE4, 0xEC, 0xF1, 0xA5, 0x34, 0xA8, 0x9A, 0x07, 0x86 };
static const uint8_t T2[16] =
{ 0x06, 0xC1, 0xF0, 0xF5, 0xEA, 0xED, 0x45, 0x3C, 0xAF, 0x78, 0xE0, 0x1A, 0x3D, 0x16, 0xA0, 0x01 };
static const uint8_t T3[16] =
{ 0x37, 0x3C, 0x0F, 0xA7, 0xC5, 0x2A, 0x07, 0x98, 0xEC, 0x36, 0xEA, 0xDF, 0xE3, 0x87, 0xC3, 0xEF };
static const uint8_t T4[16] =
{ 0xC8, 0xBF, 0x18, 0xAC, 0x79, 0x6B, 0x0B, 0x1D, 0x3A, 0x12, 0x56, 0xD3, 0xA9, 0x16, 0x76, 0xC8 };

const uint8_t k5[16] = {
    0x40, 0xEB, 0xB3, 0xEB, 0x94, 0x21, 0x20, 0xAB, 0x51, 0x74, 0xCE, 0x41, 0xC9, 0x8C, 0x8A, 0xC0 };
const uint8_t v5[32] = {
    0x39, 0xFB, 0x31, 0x6C, 0x5D, 0xE7, 0x8C, 0x16, 0x08, 0xCB, 0x09, 0xAC, 0x24, 0x71, 0xAD, 0x36,
    0x91, 0xB2, 0x20, 0x91, 0x95, 0x11, 0xCF, 0x5F, 0xE6, 0x88, 0x3D, 0x98, 0x23, 0xE8, 0x94, 0x5C };
const uint8_t V5x[32] = {
    0x58, 0xA8, 0xC1, 0x6B, 0x2A, 0x48, 0xCF, 0xEA, 0x9C, 0xA2, 0x8F, 0xE2, 0x31, 0xF2, 0xB6, 0xAC,
    0xFD, 0x22, 0x93, 0xF1, 0x82, 0x28, 0x48, 0x12, 0x92, 0xBB, 0x32, 0xBC, 0xFF, 0x3D, 0x64, 0x87 };
const uint8_t V5y[32] = {
    0x48, 0xF7, 0xEA, 0x04, 0x20, 0x3D, 0x6F, 0x1E, 0x75, 0x0A, 0x6A, 0x25, 0x91, 0x27, 0xC6, 0x94,
    0xFD, 0xFA, 0xCD, 0x50, 0x5F, 0x12, 0x17, 0xB5, 0xE1, 0x7C, 0xA9, 0xD8, 0x7E, 0x7F, 0x2D, 0x18 };
const uint8_t C5[16] = {
    0x35, 0x12, 0x17, 0x0E, 0x04, 0x49, 0xBC, 0x55, 0xE0, 0xDD, 0x75, 0x01, 0xC2, 0x0E, 0x99, 0xB8 };
const uint8_t T5[16] = {
    0x5E, 0x15, 0x9C, 0x27, 0x51, 0xEE, 0xE4, 0xB5, 0x1A, 0x56, 0x78, 0xD0, 0x4E, 0xA3, 0x6D, 0x3C };
const uint8_t r5[32] = {
    0xF4, 0xF7, 0xA4, 0x88, 0x14, 0x48, 0x03, 0x6D, 0xFC, 0xA6, 0xA4, 0x0D, 0xB4, 0x29, 0x13, 0xCD,
    0xC0, 0x9D, 0x17, 0xAA, 0xCB, 0xC0, 0x02, 0x8D, 0x5F, 0x81, 0xDE, 0x79, 0x29, 0x59, 0x76, 0xD2 };
const uint8_t R5x[32] = {
    0x05, 0x42, 0xFF, 0x28, 0xF6, 0x64, 0x86, 0xC4, 0xAF, 0x18, 0xEB, 0xC5, 0x60, 0xD9, 0x10, 0x83,
    0x87, 0x1C, 0x24, 0x33, 0x1B, 0x89, 0x19, 0x85, 0xE9, 0x2E, 0xCE, 0xC8, 0xC9, 0x8C, 0xAD, 0xE9 };
const uint8_t R5y[32] = {
    0x39, 0x65, 0x34, 0xF1, 0x8A, 0x71, 0x11, 0x1A, 0x4E, 0xB4, 0xDE, 0x53, 0xFA, 0x26, 0xA7, 0x23,
    0x20, 0x75, 0x91, 0x5E, 0x89, 0xC0, 0x7D, 0xAB, 0x88, 0x30, 0x5C, 0x39, 0x34, 0x52, 0x7B, 0x49 };
const uint8_t P5[32] = {
    0x06, 0xB8, 0xAC, 0xCA, 0xB6, 0x68, 0x84, 0x62, 0x2F, 0x34, 0x56, 0x8A, 0xDF, 0x2C, 0xE2, 0xD2,
    0x57, 0x1D, 0x99, 0xD5, 0x00, 0x15, 0xED, 0x51, 0x75, 0x69, 0x09, 0xBD, 0x25, 0x3D, 0x4C, 0xA2 };

const uint8_t k6[16] = {
    0x68, 0x10, 0x4E, 0xD3, 0x39, 0x4F, 0xD4, 0xE9, 0x03, 0x89, 0xA0, 0x85, 0x59, 0x7E, 0x47, 0x91 };
const uint8_t v6[32] = {
    0xB2, 0xD0, 0xF3, 0x1F, 0xC9, 0xE9, 0x27, 0xDD, 0x1E, 0xB5, 0x29, 0xFB, 0xF3, 0x0A, 0xB6, 0xB8,
    0x32, 0x72, 0x63, 0xD9, 0x23, 0x81, 0xA5, 0x8F, 0x03, 0xD6, 0x96, 0xDE, 0x3F, 0x12, 0xCB, 0xAA };
const uint8_t V6x[32] = {
    0x8C, 0xCE, 0xE1, 0x14, 0x0B, 0x56, 0xED, 0x1A, 0xC5, 0xB0, 0x21, 0x97, 0x01, 0x2D, 0xDE, 0x7E,
    0x04, 0xEF, 0x9A, 0xAC, 0xDC, 0x31, 0xF7, 0x7C, 0xF5, 0x5F, 0x7D, 0x24, 0x5E, 0x96, 0x2F, 0x3D };
const uint8_t V6y[32] = {
    0x7D, 0xB5, 0x91, 0x97, 0x59, 0xEA, 0x47, 0xC1, 0x60, 0x2D, 0x27, 0x16, 0xC8, 0xC7, 0x0B, 0x8E,
    0x14, 0x55, 0xEE, 0xA1, 0x08, 0x0C, 0x39, 0xD5, 0xF1, 0x0E, 0x54, 0xDD, 0xE6, 0x66, 0xF4, 0x3E };
const uint8_t C6[16] = {
    0x7C, 0x10, 0xA9, 0x9E, 0xE6, 0xC9, 0x18, 0x38, 0x72, 0x09, 0xBD, 0xAA, 0xD4, 0xB2, 0xDD, 0xC6 };
const uint8_t T6[16] = {
    0xC3, 0x06, 0x31, 0xAB, 0x60, 0xD1, 0x16, 0xA2, 0xCA, 0x4F, 0xBE, 0xC9, 0x7C, 0x71, 0x18, 0x24 };

typedef struct {
    const uint8_t* v;  // Sender�s ephemeral private key
    const uint8_t* Vx; // Sender�s ephemeral public key X
    const uint8_t* Vy; // Sender�s ephemeral public key Y
    const uint8_t* k;  // AES key to be encrypted [16 bytes]
    const uint8_t* p1; // Hash(RecipientInfo) [16 bytes]
    const uint8_t* r;  // Recipient�s private key (decryption input)
    const uint8_t* Rx; // Recipient�s public key X
    const uint8_t* Ry; // Recipient�s public key Y
    const uint8_t* C;  // Encrypted (wrapped) AES key
    const uint8_t* T;  // Authentication tag
}EciesVector;

static const EciesVector _eciesVectors[] = {
    {&v1[0], &V1x[0], &V1y[0], &k1[0], &P1[0], &r1[0], &R1x[0], &R1y[0], &C1[0], &T1[0]},
    {&v2[0], &V2x[0], &V2y[0], &k1[0], &P1[0], &r1[0], &R1x[0], &R1y[0], &C2[0], &T2[0]},
    {&v1[0], &V1x[0], &V1y[0], &k3[0], &P3[0], &r3[0], &R3x[0], &R3y[0], &C3[0], &T3[0]},
    {&v4[0], &V4x[0], &V4y[0], &k3[0], &P3[0], &r3[0], &R3x[0], &R3y[0], &C4[0], &T4[0]},
    {&v5[0], &V5x[0], &V5y[0], &k5[0], &P5[0], &r5[0], &R5x[0], &R5y[0], &C5[0], &T5[0]},
    {&v6[0], &V6x[0], &V6y[0], &k6[0], &P5[0], &r5[0], &R5x[0], &R5y[0], &C6[0], &T6[0]}
};

const uint8_t MK1[] = { 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B, 0x0B };
const uint8_t MM1[] = { 0x48, 0x69, 0x20, 0x54, 0x68, 0x65, 0x72, 0x65 };
const uint8_t MT1[] = { 0xB0, 0x34, 0x4C, 0x61, 0xD8, 0xDB, 0x38, 0x53, 0x5C, 0xA8, 0xAF, 0xCE, 0xAF, 0x0B, 0xF1, 0x2B };

const uint8_t MK2[] = { 0x4A, 0x65, 0x66, 0x65 };
const uint8_t MM2[] = { 0x77, 0x68, 0x61, 0x74, 0x20, 0x64, 0x6F, 0x20, 0x79, 0x61, 0x20, 0x77, 0x61, 0x6E, 0x74, 0x20,
                       0x66, 0x6F, 0x72, 0x20, 0x6E, 0x6F, 0x74, 0x68, 0x69, 0x6E, 0x67, 0x3F };
const uint8_t MT2[] = { 0x5B, 0xDC, 0xC1, 0x46, 0xBF, 0x60, 0x75, 0x4E, 0x6A, 0x04, 0x24, 0x26, 0x08, 0x95, 0x75, 0xC7 };

const uint8_t MK3[] = { 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                       0xAA, 0xAA, 0xAA, 0xAA };
const uint8_t MM3[] = { 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD,
                       0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD,
                       0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD, 0xDD,
                       0xDD, 0xDD };
const uint8_t MT3[] = { 0x77, 0x3E, 0xA9, 0x1E, 0x36, 0x80, 0x0E, 0x46, 0x85, 0x4D, 0xB8, 0xEB, 0xD0, 0x91, 0x81, 0xA7 };

const uint8_t MK4[] = { 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x10,
                       0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19 };
const uint8_t MM4[] = { 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD,
                       0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD,
                       0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD, 0xCD,
                       0xCD, 0xCD };
const uint8_t MT4[] = { 0x82, 0x55, 0x8A, 0x38, 0x9A, 0x44, 0x3C, 0x0E, 0xA4, 0xCC, 0x81, 0x98, 0x99, 0xF2, 0x08, 0x3A };

const uint8_t MK5[] = { 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C, 0x0C,
                       0x0C, 0x0C, 0x0C, 0x0C };
const uint8_t MM5[] = { 0x54, 0x65, 0x73, 0x74, 0x20, 0x57, 0x69, 0x74, 0x68, 0x20, 0x54, 0x72, 0x75, 0x6E, 0x63, 0x61,
                       0x74, 0x69, 0x6F, 0x6E };
const uint8_t MT5[] = { 0xA3, 0xB6, 0x16, 0x74, 0x73, 0x10, 0x0E, 0xE0, 0x6E, 0x0C, 0x79, 0x6C, 0x29, 0x55, 0x55, 0x2B };

const uint8_t MK6[] = { 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA };
const uint8_t MM6[] = { 0x54, 0x65, 0x73, 0x74, 0x20, 0x55, 0x73, 0x69, 0x6E, 0x67, 0x20, 0x4C, 0x61, 0x72, 0x67, 0x65,
                        0x72, 0x20, 0x54, 0x68, 0x61, 0x6E, 0x20, 0x42, 0x6C, 0x6F, 0x63, 0x6B, 0x2D, 0x53, 0x69, 0x7A,
                        0x65, 0x20, 0x4B, 0x65, 0x79, 0x20, 0x2D, 0x20, 0x48, 0x61, 0x73, 0x68, 0x20, 0x4B, 0x65, 0x79,
                        0x20, 0x46, 0x69, 0x72, 0x73, 0x74 };
const uint8_t MT6[] = { 0x60, 0xE4, 0x31, 0x59, 0x1E, 0xE0, 0xB6, 0x7F, 0x0D, 0x8A, 0x26, 0xAA, 0xCB, 0xF5, 0xB7, 0x7F };

const uint8_t MK7[] = { 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA, 0xAA,
                        0xAA, 0xAA, 0xAA };
const uint8_t MM7[] = { 0x54, 0x68, 0x69, 0x73, 0x20, 0x69, 0x73, 0x20, 0x61, 0x20, 0x74, 0x65, 0x73, 0x74, 0x20, 0x75,
                        0x73, 0x69, 0x6E, 0x67, 0x20, 0x61, 0x20, 0x6C, 0x61, 0x72, 0x67, 0x65, 0x72, 0x20, 0x74, 0x68,
                        0x61, 0x6E, 0x20, 0x62, 0x6C, 0x6F, 0x63, 0x6B, 0x2D, 0x73, 0x69, 0x7A, 0x65, 0x20, 0x6B, 0x65,
                        0x79, 0x20, 0x61, 0x6E, 0x64, 0x20, 0x61, 0x20, 0x6C, 0x61, 0x72, 0x67, 0x65, 0x72, 0x20, 0x74,
                        0x68, 0x61, 0x6E, 0x20, 0x62, 0x6C, 0x6F, 0x63, 0x6B, 0x2D, 0x73, 0x69, 0x7A, 0x65, 0x20, 0x64,
                        0x61, 0x74, 0x61, 0x2E, 0x20, 0x54, 0x68, 0x65, 0x20, 0x6B, 0x65, 0x79, 0x20, 0x6E, 0x65, 0x65,
                        0x64, 0x73, 0x20, 0x74, 0x6F, 0x20, 0x62, 0x65, 0x20, 0x68, 0x61, 0x73, 0x68, 0x65, 0x64, 0x20,
                        0x62, 0x65, 0x66, 0x6F, 0x72, 0x65, 0x20, 0x62, 0x65, 0x69, 0x6E, 0x67, 0x20, 0x75, 0x73, 0x65,
                        0x64, 0x20, 0x62, 0x79, 0x20, 0x74, 0x68, 0x65, 0x20, 0x48, 0x4D, 0x41, 0x43, 0x20, 0x61, 0x6C,
                        0x67, 0x6F, 0x72, 0x69, 0x74, 0x68, 0x6D, 0x2E };
const uint8_t MT7[] = { 0x9B, 0x09, 0xFF, 0xA7, 0x1B, 0x94, 0x2F, 0xCB, 0x27, 0x63, 0x5F, 0xBC, 0xD5, 0xB0, 0xE9, 0x44 };

struct {
    const uint8_t* K;
    size_t klen;
    const uint8_t* M;
    size_t mlen;
    const uint8_t* T;
} _macVectors[] = {
#define MACVECTOR(N) { &MK ## N [0], sizeof(MK ## N), &MM ## N[0], sizeof(MM ## N), &MT ## N [0] }
    MACVECTOR(1),
    MACVECTOR(2),
    MACVECTOR(3),
    MACVECTOR(4),
    MACVECTOR(5),
    MACVECTOR(6),
    MACVECTOR(7),
};

static const char * curve_names[] = {
    "nist256",
    "brainpool256",
    "brainpool384",
    "nist384",
    "sm2"
};

int main(int argc, char** argv)
{
    int ret = 0;
    FSCrypt* e = FSCrypt_FindEngine("openssl");
    if (!e) return -1;
    FSCrypt_InitEngine(e, NULL);
    
    uint8_t out[256];
    uint8_t buf[256];

    printf("Signature\n");
    for (int i = 0; i < sizeof(_sign_vectors) / sizeof(_sign_vectors[0]); i++) {
        FSCurve curve = _sign_vectors[i].curve;
        FSHashAlg ha = FSCurve_HashAlg(curve);
        size_t fsize = FSCurve_FieldSize(curve);
        if(_sign_vectors[i].data){
            printf("%d: Hash calculation [%s]:", i, curve_names[curve]);
            ret = FSHash_Calc(e, ha,  _sign_vectors[i].data, _sign_vectors[i].data_size, out);
            if(ret != fsize){
                printf("\tHash size %d doesn't match curve field size %d\n", (int)ret, (int)fsize);
            }else if(cmemcmp(out, _sign_vectors[i].hash, fsize)){
                printf("\tmismatch\n");
            }else{
                printf("\tOK\n");
            }
        }

        FSSignature s = {
            .curve = _sign_vectors[i].curve, 
            .point = {
                .type = FS_X_COORDINATE_ONLY,
                .x = out
            },
            .s = out + fsize
        };

        FSPublicKey pub = {
            .curve = _sign_vectors[i].curve,
            .point = {
                .type = FS_UNCOMPRESSED,
                .x = buf,
                .y = buf + fsize
            }
        };

        // import private key
        ret = 0;
        if(_sign_vectors[i].k){
            FSPrivateKey * k = FSKey_ImportPrivate(e, curve, _sign_vectors[i].prk, fsize);
            printf("%d: Signature gen [%s]:", i, curve_names[curve]);
            if(k == NULL){
                printf("\tcan not import private key\n");
            }else{
                // sign
                if(!FSSignature_Sign_ex(e, &s, k, _sign_vectors[i].hash, _sign_vectors[i].k)){
                    printf("\tcan not calculate signature\n");
                }else{
                    if(cmemcmp(_sign_vectors[i].r, out, fsize)){
                        ret = 1;
                        printf("\tR value mismatch\n");
                    }else if(cmemcmp(_sign_vectors[i].s, out+fsize, fsize)){
                        ret = 1;
                        printf("\ts value mismatch\n");
                    }else{
                        printf("\tOK\n");
                    }
                }

                printf("%d: Pub key calc [%s]:", i, curve_names[curve]);
                if(!FSKey_ExportPublic(e, k, &pub)){
                    printf("\tkey calculation failed\n");
                }else{
                    if(cmemcmp(_sign_vectors[i].pub_x, pub.point.x, fsize)){
                        printf("\tX value mismatch\n");
                    }else if(_sign_vectors[i].pub_y && cmemcmp(_sign_vectors[i].pub_y, pub.point.y, fsize)){
                        printf("\tY value mismatch\n");
                    }else{
                        printf("\tOK\n");
                    }
                }
                FSKey_FreePrivate(e, k);
            }
        }

        FSKey_InitPublic(&pub, curve,
            _sign_vectors[i].pub_y ? FS_UNCOMPRESSED : FS_COMPRESSED_LSB_Y_0,
            _sign_vectors[i].pub_x, _sign_vectors[i].pub_y);
        if(ret){
            printf("%d: Verify generated [%s]:", i, curve_names[curve]);
            if(!FSSignature_Verify(e, &s, &pub, _sign_vectors[i].hash)){
                printf("\tfailed\n");
            }else{
                printf("\tOK\n");
            }
        }

        s.point.x = (uint8_t*)_sign_vectors[i].r;
        s.s = (uint8_t*)_sign_vectors[i].s;
        printf("%d: Verify pre-def [%s]:", i, curve_names[curve]);
        if(!FSSignature_Verify(e, &s, &pub, _sign_vectors[i].hash)){
            printf("\tfailed\n");
        }else{
            printf("\tOK\n");
        }
    }

    printf("Encryption\n");
    for (int i = 0; i < sizeof(_SymmEncVectors) / sizeof(_SymmEncVectors[0]); i++) {
        const SymmEncVector* v = &_SymmEncVectors[i];
        printf("%d: Encrypt %d bytes: ", i, (int)v->pt_len);
        size_t l = FSSymm_Encrypt(e, FS_AES_128_CCM, v->key, v->nonce, v->pt, v->pt_len, out, sizeof(out));
        if (l != v->ct_len) {
            printf("\tERROR: encrypted length is %d instead of %d\n", (int)l, (int)v->ct_len);
            ret++;
        }
        else if (0 != memcmp(out, v->ct, l)) {
            printf("\tERROR: encrypted data is wrong\n");
            ret++;
        }
        else {
            printf("\tOK\n");
        }
    }

    printf("\nDecryption\n");
    for (int i = 0; i < sizeof(_SymmEncVectors) / sizeof(_SymmEncVectors[0]); i++) {
        const SymmEncVector* v = &_SymmEncVectors[i];
        printf("%d: Decrypt %d bytes: ", i, (int)v->ct_len);
        size_t l = FSSymm_Decrypt(e, FS_AES_128_CCM, v->key, v->nonce, v->ct, v->ct_len, out, sizeof(out));
        if (l != v->pt_len) {
            printf("\tERROR: decrypted length is %d instead of %d\n", (int)l, (int)v->pt_len);
            ret++;
        }
        else if (0 != memcmp(out, v->pt, l)) {
            printf("\tERROR: decrypted data is wrong\n");
            ret++;
        }
        else {
            printf("\tOK\n");
        }
    }

    printf("\nMAC:\n");
    for (int i = 0; i < sizeof(_macVectors) / sizeof(_macVectors[0]); i++) {
        size_t l = FSCrypt_MAC(e, FS_HMAC256, _macVectors[i].M, _macVectors[i].mlen, _macVectors[i].K, _macVectors[i].klen, out);
        if (l != 16) {
            printf("%d: MAC output length mismatch(%zd)\n", i, l);
        }
        else if (memcmp(out, _macVectors[i].T, l)) {
            printf("%d: MAC: Tag value mismatch\n", i);
        }else {
            printf("%d: MAC \t\t\tOK\n", i);
        }
    }

    printf("\nECIES\n");
    for (int i = 0; i < sizeof(_eciesVectors) / sizeof(_eciesVectors[0]); i++) {
        const EciesVector* v = &_eciesVectors[i];


        FSPublicKey pub;
        FSKey_InitPublic(&pub, FS_NISTP256, FS_UNCOMPRESSED, out, &out[32]);

        printf("%d: Check Eph key:", i);
        FSPrivateKey* eph = FSKey_ImportPrivate(e, FS_NISTP256, v->v, 32);
        FSKey_ExportPublic(e, eph, &pub);
        if (memcmp(pub.point.x, v->Vx, 32)) {
            printf("\tX coordinate mismatch;\n");
            ret++;
        }else if (memcmp(pub.point.y, v->Vy, 32)) {
            printf("\tY coordinate mismatch;\n");
            ret++;
        }else {
            printf("\tOK\n");
        }

        printf("%d: Check Receiver key:", i);
        FSPrivateKey* rcv = FSKey_ImportPrivate(e, FS_NISTP256, v->r, 32);
        FSKey_ExportPublic(e, rcv, &pub);
        if (memcmp(pub.point.x, v->Rx, 32)) {
            printf("\tX coordinate mismatch;\n");
            ret++;
        }
        else if (memcmp(pub.point.y, v->Ry, 32)) {
            printf("\tY coordinate mismatch;\n");
            ret++;
        }
        else {
            printf("\tOK\n");
        }

        printf("%d: Derive AES (send):", i);
        FSKey_InitPublic(&pub, FS_NISTP256, FS_UNCOMPRESSED, &v->Rx[0], &v->Ry[0]);
        FSKey_Derive(e, &pub, eph, v->p1, 32, out, 64);
        _xor_sym_key_aligned(out+64, out, v->k, 16);
        if (0 != memcmp(out+64, v->C, 16)) {
            printf("\tERROR: Encrypted AES mismatch\n");
            ret++;
        }else {
            printf("\tOK: ");
//            hexdump(stdout, out + 64, 16);
            fputc('\n', stdout);
        }
        
 //       printf("Send SS:\n"); hexdump(stdout, out, 64); fputc('\n', stdout);

        printf("%d: MAC:", i);
        FSCrypt_MAC(e, FS_HMAC256, v->C, 16, out + 16, 32, out+64);
        if (0 != memcmp(out+64, v->T, 16)) {
            printf("\t\t\tERROR: MAC mismatch\n");
            ret++;
        }
        else {
            printf("\t\t\tOK\n");
        }

        printf("%d: Derive AES (rcv):", i);
        // create new eph key
        FSKey_CleanPublic(e, &pub);
        FSKey_InitPublic(&pub, FS_NISTP256, FS_UNCOMPRESSED, &v->Vx[0], &v->Vy[0]);
        FSKey_Derive(e, &pub, rcv, v->p1, 32, out+64, 64);
        if (0 != memcmp(out, out + 64, 64)) {
            printf("\tERROR: Send and Recv SS mismatch\n");
            ret++;
        }
        else {
            _xor_sym_key_aligned(out, out + 64, v->C, 16);
            if (0 != memcmp(out, v->k, 16)) {
                printf("\tERROR: Plain AES mismatch\n");
                ret++;
            }
            else {
                printf("\tOK\n");
            }
        }
//        printf("Recv SS:\n"); hexdump(stdout, out+64, 64); fputc('\n', stdout);
        FSKey_CleanPublic(e, &pub);
        FSKey_FreePrivate(e, eph);
        FSKey_FreePrivate(e, rcv);



    }
    return ret;
}

static void* _xor_sym_key_aligned(void* const out, const void* const p1, const void* const p2, size_t len)
{
    uint32_t* p = (uint32_t*)out;
    uint32_t* en = p + (len / sizeof(uint32_t));
    uint32_t* n1 = (uint32_t*)p1;
    uint32_t* n2 = (uint32_t*)p2;
    while (p < en) {
        *p++ = (*n1++) ^ (*n2++);
    }
    return p;
}
/*
static const char* _hexDigits = "0123456789ABCDEF";
static void hexdump(FILE * f, const uint8_t* b, size_t len)
{
    for(size_t i=0; i < len;i++){
        uint8_t c = b[i];
        if (i && 0 == (i & 0xF)) {
            fputc('\n', f);
        }
        fputc(_hexDigits[c >> 4], f);
        fputc(_hexDigits[c & 0xF], f);
    }
    fputc('\n', f);
}
*/